{"version":3,"file":"index.modern.js","sources":["../src/adapter/scene.tsx","../src/adapter/useAttributes.tsx","../src/adapter/text.tsx","../src/adapter/image.tsx","../src/adapter/table.tsx"],"sourcesContent":["import React, {\n  CSSProperties,\n  FC,\n  useEffect,\n  useRef,\n  createContext,\n  useReducer,\n  useContext,\n} from \"react\";\nimport { Props, EventType } from \"./types\";\n\ninterface State {\n  devicePixelRatio: number;\n  canvas: HTMLCanvasElement | null;\n  context: CanvasRenderingContext2D | null;\n  events: Array<EventType>;\n  shapes: Set<any>;\n}\n\ninterface Action {\n  type: string;\n  body: {\n    type: string;\n    handle: () => void;\n    rect?: { x: number; y: number; width: number; height: number };\n    content?: string;\n    src?: string;\n  };\n  state: State;\n}\n\nconst initialState = {\n  devicePixelRatio: 1,\n  canvas: null,\n  context: null,\n  events: [],\n  shapes: new Set(),\n};\n\nconst reducer = (state: State, action: Action) => {\n  switch (action.type) {\n    case \"initialize\":\n      return Object.assign(state, action.state);\n    case \"update:shape\":\n      return {\n        ...state,\n        events: [...state.events, action.body.type],\n        shapes: state.shapes.add(action.body),\n      };\n    default:\n      return state;\n  }\n};\n\n/**\n * provider context {text/image/path/label}\n */\ninterface ContextProps {\n  state: string;\n  dispatch: ({ type }: { type: string }) => void;\n}\n// React.Context<ContextProps>\nconst context: any = createContext({} as ContextProps);\n/**\n * provider\n * @param {Function} props\n * @param {Object} attributes\n * @param {Array} event\n */\nconst Scene: FC<Props> = (props: Props) => {\n  console.log(`render Scene`);\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <context.Provider value={{ state, dispatch }}>\n      <Stage {...props} />\n      {props.children}\n    </context.Provider>\n  );\n};\n\n/**\n * createCanvas\n * @param {object} props\n * @param {json} attributes\n */\nconst Stage: FC<Props> = (props: Props) => {\n  console.log(`render Stage`);\n  const { state, dispatch } = useContext(context);\n  const stageRef = useRef(null);\n  const attributes = (props.attribute || {}) as CSSProperties;\n\n  useEffect(() => {\n    const canvas: HTMLCanvasElement | null = stageRef.current;\n    const devicePixelRatio = window.devicePixelRatio || 1;\n    canvas!.width = ~~canvas!.clientWidth * devicePixelRatio;\n    canvas!.height = ~~canvas!.clientHeight * devicePixelRatio;\n    const context = canvas!.getContext(\"2d\");\n    const state = { devicePixelRatio, canvas, context };\n    dispatch({ type: \"initialize\", state: state });\n  }, []);\n\n  useEffect(() => {\n    state.events.forEach((type: string) => {\n      state.canvas.addEventListener(type, stageHandle);\n    });\n    return () => {\n      state.events.forEach((type: string) => {\n        state.canvas.removeEventListener(type, stageHandle);\n      });\n    };\n  }, [state.events]);\n\n  function stageHandle(e: MouseEvent | TouchEvent): void {\n    const node = e.target as HTMLElement;\n    const { left, top } = node.getBoundingClientRect();\n    let originalX, originalY;\n    const evtArgs = {\n      originalEvent: e,\n      type: event,\n    };\n    if (isTouch(e)) {\n      const { clientX, clientY } = (e as TouchEvent).changedTouches[0];\n      originalX = Math.round(clientX - left);\n      originalY = Math.round(clientY - top);\n    } else {\n      originalX = Math.round((e as MouseEvent).clientX - left);\n      originalY = Math.round((e as MouseEvent).clientY - top);\n    }\n    let x: number, y: number;\n    x = state.devicePixelRatio * originalX;\n    y = state.devicePixelRatio * originalY;\n    Object.assign(evtArgs, { originalX, originalY }, { x, y });\n    state.shapes.forEach((shape: any) => {\n      e.type === shape.type\n        ? isInside({ x, y }, shape.rect)\n          ? shape.handle()\n          : 0\n        : 0;\n    });\n    e.preventDefault();\n  }\n\n  // function isTouch(\n  //   e: React.TouchEvent | React.MouseEvent\n  // ): e is React.TouchEvent {\n  //   return e.nativeEvent instanceof TouchEvent;\n  // }\n\n  function isTouch(e: MouseEvent | TouchEvent): Boolean {\n    return e instanceof TouchEvent;\n  }\n\n  function isInside(\n    pos: { x: number; y: number },\n    rect: { x: number; y: number; width: number; height: number }\n  ) {\n    return (\n      pos.x > rect.x &&\n      pos.x < rect.x + rect.width &&\n      pos.y < rect.y + rect.height &&\n      pos.y > rect.y\n    );\n  }\n\n  return (\n    <canvas\n      ref={stageRef}\n      style={attributes}\n      onContextMenu={(e: React.MouseEvent<HTMLElement>): void => {\n        e.preventDefault();\n      }}\n      onMouseOver={() => {\n        const canvas: HTMLCanvasElement | null = stageRef.current;\n        canvas!.style.cursor = \"pointer\";\n      }}\n      onMouseOut={() => {\n        const canvas: HTMLCanvasElement | null = stageRef.current;\n        canvas!.style.cursor = \"default\";\n      }}\n    />\n  );\n};\n\nexport { Scene, context };\n","import { useContext, useEffect } from \"react\";\nimport { Props, Attribute } from \"./types\";\nimport { context } from \"./scene\";\n\n/**\n * attribute && event\n * @param {object} props\n * @param {string} type text/image\n */\nexport default function (props: Props, attributes?: Attribute) {\n  //   const { state, dispatch } = useContext(context);\n  const { dispatch } = useContext(context);\n\n  const defaultAttributes: Attribute = {\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 0,\n    height: 0,\n    border: 0,\n  };\n\n  const attritube = Object.assign(\n    {},\n    defaultAttributes,\n    attributes,\n    props.attribute\n  );\n\n  const event = props.event || false;\n\n  // if (!!event && !sourceEvents.includes(event.type))\n  //   throw new Error(\"eventType not Support\");\n\n  let x, y, width, height;\n  x = attritube.left;\n  y = attritube.top;\n  width = attritube.width;\n  height = attritube.height;\n  const rect = { x, y, width, height };\n  useEffect(() => {\n    dispatch({\n      type: \"update:shape\",\n      body: { rect, ...event },\n    });\n  }, []);\n  return attritube;\n}\n","import { useContext, useEffect } from \"react\";\nimport { context } from \"./scene\";\nimport useAttributes from \"./useAttributes\";\nimport { Props, Attribute, Event } from \"./types\";\n\ninterface TextProps extends Props {\n  content: string;\n  event?: Event;\n}\n\nfunction Text(props: TextProps) {\n  const defaultAttributes: Attribute = {\n    textAlign: \"left\",\n    textBaseline: \"top\",\n    font: \"25px Lato\",\n    fillStyle: \"#fff\",\n  };\n\n  const { state } = useContext(context);\n\n  const attributes = useAttributes(props, defaultAttributes);\n  const text = props.content;\n  useEffect(() => {\n    // state.context.font = attributes.font;\n    // state.context.fillStyle = attributes.fillStyle;\n    // state.context.textBaseline = attributes.textBaseline;\n    // state.context.fillText(attributes.Text, attributes.left, attributes.top);\n\n    renderText(state.context, attributes, text);\n  }, [props.content]);\n\n  return null;\n}\n\n/**\n *\n * @param {object} context\n * @param {object} attributes top left width height x y font fontSize fillStyle\n */\nfunction renderText(\n  ctx: CanvasRenderingContext2D,\n  attributes: Required<Attribute>,\n  content: string\n): void {\n  ctx.font = attributes.font;\n  ctx.fillStyle = attributes.fillStyle;\n  ctx.textBaseline = attributes.textBaseline;\n  ctx.textAlign = attributes.textAlign;\n  //let distText = attributes.filterText(ctx, attributes.text);\n  attributes.width = attributes.width || ctx.measureText(content).width;\n\n  if (attributes.textAlign === \"right\") {\n    attributes.left += attributes.width;\n  }\n  if (attributes.textAlign === \"center\") {\n    attributes.left += attributes.width / 2;\n  }\n  if (!!attributes.border) {\n    ctx.rect(\n      attributes.left,\n      attributes.top,\n      attributes.width,\n      attributes.height\n    );\n    ctx.stroke();\n  }\n  ctx.fillText(content, attributes.left, attributes.top);\n}\n\nexport { Text, renderText };\n","import { useContext, useEffect } from \"react\";\nimport { context } from \"./scene\";\nimport useAttributes from \"./useAttributes\";\nimport { Props, Attribute, Event } from \"./types\";\ninterface ImageProps extends Props {\n  src: string;\n  event?: Event;\n}\n\nfunction Image(props: ImageProps) {\n  const { state } = useContext(context);\n  const attributes = useAttributes(props);\n  useEffect(() => {\n    let image: HTMLImageElement = document.createElement(\"img\");\n    // image.setAttribute(\"crossOrigin\", \"anonymous\");\n    image.addEventListener(\"load\", () => {\n      renderImage(state.context, attributes, image);\n    });\n    image.onerror = (err) => {\n      console.log(err);\n    };\n    // ?${+new Date()}\n    image.src = `${props.src}`;\n    return () => {\n      image.onerror = null;\n      image.removeEventListener(\"load\", () => {});\n    };\n    // renderImage(state.context, attributes, props.src);\n  }, [props.src]);\n\n  return null;\n}\n\nfunction renderImage(\n  ctx: CanvasRenderingContext2D,\n  attributes: Attribute,\n  image: HTMLImageElement\n): void {\n  const { left, top, width, height, border } = attributes;\n  if (left && top && width && height) {\n    if (!!border) {\n      ctx.rect(left, top, width, height);\n      ctx.stroke();\n    }\n    ctx.drawImage(image, left, top, width, height);\n  } else {\n    console.log(`renderImage<drawImage> arguments lost`);\n  }\n}\n\nexport { Image, renderImage };\n","import {\n  useContext,\n  useEffect,\n  // useEffect\n} from \"react\";\nimport { context } from \"./scene\";\nimport useAttributes from \"./useAttributes\";\nimport { Props, Attribute, Event } from \"./types\";\n\n// table header\ninterface Summary {\n  displayName: string;\n  key: string;\n  width?: number;\n  fillStyle?: string;\n}\n\ninterface TableProps extends Props {\n  summary: Array<Summary>;\n  data: Array<Object>;\n  event?: Event;\n}\n\nfunction Table(props: TableProps) {\n  const { state } = useContext(context);\n  const attributes = useAttributes(props);\n  const { summary, data } = props;\n\n  useEffect(() => {\n    renderTable(state.context, attributes, summary, data);\n    return;\n  }, [summary, data]);\n\n  return null;\n}\n\n/**\n *\n * @param {object} context\n * @param {object} attributes\n */\nfunction renderTable(\n  ctx: CanvasRenderingContext2D,\n  attributes: Attribute,\n  summary: Array<Summary>,\n  data: Array<Object>\n): void {\n  console.log(`renderTable`, summary, data);\n  const { left, top, width, height, border } = attributes;\n  // calculate cell\n  const rows = data.length + 1;\n  const columns = summary.length;\n\n  if (left && top && width && height) {\n    // default width\n    let cellWidth = width / columns;\n    let cellHeight = height / rows;\n\n    ctx.lineWidth = 1;\n    ctx.strokeStyle = \"#ccc\";\n    ctx.textAlign = \"center\";\n    ctx.fillStyle = \"#000000\";\n\n    summary.forEach((s, i) => {\n      if (s.fillStyle) {\n        ctx.fillStyle = s.fillStyle;\n      }\n      if (s.width) {\n        ctx.fillText(\n          s.displayName,\n          cellWidth * i + cellWidth / 2 + left,\n          top + cellHeight / 2.3\n        );\n      } else {\n        ctx.fillText(\n          s.displayName,\n          cellWidth * i + cellWidth / 2 + left,\n          top + cellHeight / 2.3\n        );\n      }\n    });\n\n    ctx.save();\n\n    for (let r = 0; r < rows + 1; r++) {\n      ctx.moveTo(0 + left, cellHeight * r + top);\n      ctx.lineTo(width + left, cellHeight * r + top);\n    }\n    for (let c = 0; c < columns + 1; c++) {\n      ctx.moveTo(cellWidth * c + left, 0 + top);\n      ctx.lineTo(cellWidth * c + left, height + top);\n    }\n\n    ctx.stroke();\n    ctx.restore();\n\n    data.forEach((d, i) => {\n      ctx.fillStyle = \"#000000\";\n      summary.forEach((s, index) => {\n        ctx.fillText(\n          d[s.key],\n          cellWidth * index + cellWidth / 2 + left,\n          top + cellHeight * (i + 1) + cellHeight / 2.3\n        );\n      });\n    });\n\n    if (!!border) {\n      ctx.rect(left, top, width, height);\n      ctx.stroke();\n    }\n  } else {\n    console.log(`renderImage<drawImage> arguments lost`);\n  }\n}\n\nexport { Table };\n"],"names":["initialState","devicePixelRatio","canvas","context","events","shapes","Set","reducer","state","action","type","Object","assign","body","add","createContext","Scene","props","console","log","dispatch","useReducer","React","Provider","value","Stage","children","useContext","stageRef","useRef","attributes","attribute","useEffect","current","window","width","clientWidth","height","clientHeight","getContext","forEach","addEventListener","stageHandle","removeEventListener","e","node","target","left","top","getBoundingClientRect","originalX","originalY","evtArgs","originalEvent","event","isTouch","clientX","clientY","changedTouches","Math","round","x","y","shape","isInside","rect","handle","preventDefault","TouchEvent","pos","ref","style","onContextMenu","onMouseOver","cursor","onMouseOut","defaultAttributes","right","bottom","border","attritube","Text","textAlign","textBaseline","font","fillStyle","useAttributes","text","content","renderText","ctx","measureText","stroke","fillText","Image","image","document","createElement","renderImage","onerror","err","src","drawImage","Table","summary","data","renderTable","rows","length","columns","cellWidth","cellHeight","lineWidth","strokeStyle","s","i","displayName","save","r","moveTo","lineTo","c","restore","d","index","key"],"mappings":"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"}