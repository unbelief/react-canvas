{"version":3,"file":"index.js","sources":["../src/adapter/scene.tsx","../src/adapter/useAttributes.tsx","../src/adapter/text.tsx","../src/adapter/image.tsx"],"sourcesContent":["import React, {\n  CSSProperties,\n  FC,\n  useEffect,\n  useRef,\n  createContext,\n  useReducer,\n  useContext,\n} from \"react\";\nimport { Props, EventType } from \"./types\";\n\ninterface State {\n  devicePixelRatio: number;\n  canvas: HTMLCanvasElement | null;\n  context: CanvasRenderingContext2D | null;\n  events: Array<EventType>;\n  shapes: Set<any>;\n}\n\ninterface Action {\n  type: string;\n  body: {\n    type: string;\n    handle: () => void;\n    rect?: { x: number; y: number; width: number; height: number };\n    content?: string;\n    src?: string;\n  };\n  state: State;\n}\n\nconst initialState = {\n  devicePixelRatio: 1,\n  canvas: null,\n  context: null,\n  events: [],\n  shapes: new Set(),\n};\n\nconst reducer = (state: State, action: Action) => {\n  switch (action.type) {\n    case \"initialize\":\n      return Object.assign(state, action.state);\n    case \"update:shape\":\n      return {\n        ...state,\n        events: [...state.events, action.body.type],\n        shapes: state.shapes.add(action.body),\n      };\n    default:\n      return state;\n  }\n};\n\n/**\n * provider context {text/image/path/label}\n */\ninterface ContextProps {\n  state: string;\n  dispatch: ({ type }: { type: string }) => void;\n}\n// React.Context<ContextProps>\nconst context: any = createContext({} as ContextProps);\n/**\n * provider\n * @param {Function} props\n * @param {Object} attributes\n * @param {Array} event\n */\nconst Scene: FC<Props> = (props: Props) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  return (\n    <context.Provider value={{ state, dispatch }}>\n      <Stage {...props} />\n      {props.children}\n    </context.Provider>\n  );\n};\n\n/**\n * createCanvas\n * @param {object} props\n * @param {json} attributes\n */\nconst Stage: FC<Props> = (props: Props) => {\n  const { state, dispatch } = useContext(context);\n  const stageRef = useRef(null);\n  const attributes = (props.attribute || {}) as CSSProperties;\n\n  useEffect(() => {\n    const canvas: HTMLCanvasElement | null = stageRef.current;\n    const devicePixelRatio = window.devicePixelRatio || 1;\n    canvas!.width = ~~canvas!.clientWidth * devicePixelRatio;\n    canvas!.height = ~~canvas!.clientHeight * devicePixelRatio;\n    const context = canvas!.getContext(\"2d\");\n    const state = { devicePixelRatio, canvas, context };\n    dispatch({ type: \"initialize\", state: state });\n  }, []);\n\n  useEffect(() => {\n    state.events.forEach((type: string) => {\n      state.canvas.addEventListener(type, stageHandle);\n    });\n    return () => {\n      state.events.forEach((type: string) => {\n        state.canvas.removeEventListener(type, stageHandle);\n      });\n    };\n  }, [state.events]);\n\n  function stageHandle(e: MouseEvent | TouchEvent): void {\n    const node = e.target as HTMLElement;\n    const { left, top } = node.getBoundingClientRect();\n    let originalX, originalY;\n    const evtArgs = {\n      originalEvent: e,\n      type: event,\n    };\n    if (isTouch(e)) {\n      const { clientX, clientY } = (e as TouchEvent).changedTouches[0];\n      originalX = Math.round(clientX - left);\n      originalY = Math.round(clientY - top);\n    } else {\n      originalX = Math.round((e as MouseEvent).clientX - left);\n      originalY = Math.round((e as MouseEvent).clientY - top);\n    }\n    let x: number, y: number;\n    x = state.devicePixelRatio * originalX;\n    y = state.devicePixelRatio * originalY;\n    Object.assign(evtArgs, { originalX, originalY }, { x, y });\n    state.shapes.forEach((shape: any) => {\n      e.type === shape.type\n        ? isInside({ x, y }, shape.rect)\n          ? shape.handle()\n          : 0\n        : 0;\n    });\n    e.preventDefault();\n  }\n\n  // function isTouch(\n  //   e: React.TouchEvent | React.MouseEvent\n  // ): e is React.TouchEvent {\n  //   return e.nativeEvent instanceof TouchEvent;\n  // }\n\n  function isTouch(e: MouseEvent | TouchEvent): Boolean {\n    return e instanceof TouchEvent;\n  }\n\n  function isInside(\n    pos: { x: number; y: number },\n    rect: { x: number; y: number; width: number; height: number }\n  ) {\n    return (\n      pos.x > rect.x &&\n      pos.x < rect.x + rect.width &&\n      pos.y < rect.y + rect.height &&\n      pos.y > rect.y\n    );\n  }\n\n  return (\n    <canvas\n      ref={stageRef}\n      style={attributes}\n      onContextMenu={(e: React.MouseEvent<HTMLElement>): void => {\n        e.preventDefault();\n      }}\n      onMouseOver={() => {\n        const canvas: HTMLCanvasElement | null = stageRef.current;\n        canvas!.style.cursor = \"pointer\";\n      }}\n      onMouseOut={() => {\n        const canvas: HTMLCanvasElement | null = stageRef.current;\n        canvas!.style.cursor = \"default\";\n      }}\n    />\n  );\n};\n\nexport { Scene, context };\n","import { useContext, useEffect } from \"react\";\nimport { Attribute } from \"./types\";\nimport { context } from \"./scene\";\n\n/**\n * attribute && event\n * @param {object} props\n * @param {string} type text/image\n */\nexport default function (props: any, attributes?: Attribute) {\n  //   const { state, dispatch } = useContext(context);\n  const { dispatch } = useContext(context);\n\n  const defaultAttributes: Attribute = {\n    left: 0,\n    top: 0,\n    right: 0,\n    bottom: 0,\n    width: 0,\n    height: 0,\n    border: 0,\n  };\n\n  const attritube = Object.assign(\n    {},\n    defaultAttributes,\n    attributes,\n    props.attribute\n  );\n\n  const event = props.event || false;\n\n  // if (!!event && !sourceEvents.includes(event.type))\n  //   throw new Error(\"eventType not Support\");\n\n  let x, y, width, height;\n  x = attritube.left;\n  y = attritube.top;\n  width = attritube.width;\n  height = attritube.height;\n  const rect = { x, y, width, height };\n  useEffect(() => {\n    dispatch({\n      type: \"update:shape\",\n      body: { rect, ...event },\n    });\n  }, []);\n  return attritube;\n}\n","import { useContext, useEffect } from \"react\";\nimport { context } from \"./scene\";\nimport useAttributes from \"./useAttributes\";\nimport { Props, Attribute, Event } from \"./types\";\n\ninterface TextProps extends Props {\n  content: string;\n  style?: Attribute;\n  event?: Event;\n}\n\nfunction Text(props: TextProps) {\n  const defaultAttributes: Attribute = {\n    textAlign: \"left\",\n    textBaseline: \"top\",\n    font: \"25px Lato\",\n    fillStyle: \"#fff\",\n  };\n\n  const { state } = useContext(context);\n\n  const attributes = useAttributes(props, defaultAttributes);\n  const text = props.content;\n  useEffect(() => {\n    // state.context.font = attributes.font;\n    // state.context.fillStyle = attributes.fillStyle;\n    // state.context.textBaseline = attributes.textBaseline;\n    // state.context.fillText(attributes.Text, attributes.left, attributes.top);\n\n    renderText(state.context, attributes, text);\n  }, [props.content]);\n\n  return null;\n}\n\n/**\n *\n * @param {object} context\n * @param {object} attributes top left width height x y font fontSize fillStyle\n */\nfunction renderText(\n  ctx: CanvasRenderingContext2D,\n  attributes: Required<Attribute>,\n  content: string\n): void {\n  ctx.font = attributes.font;\n  ctx.fillStyle = attributes.fillStyle;\n  ctx.textBaseline = attributes.textBaseline;\n  ctx.textAlign = attributes.textAlign;\n  //let distText = attributes.filterText(ctx, attributes.text);\n  attributes.width = attributes.width || ctx.measureText(content).width;\n\n  if (attributes.textAlign === \"right\") {\n    attributes.left += attributes.width;\n  }\n  if (attributes.textAlign === \"center\") {\n    attributes.left += attributes.width / 2;\n  }\n  if (!!attributes.border) {\n    ctx.rect(\n      attributes.left,\n      attributes.top,\n      attributes.width,\n      attributes.height\n    );\n    ctx.stroke();\n  }\n  ctx.fillText(content, attributes.left, attributes.top);\n}\n\nexport { Text, renderText };\n","import { useContext, useEffect } from \"react\";\nimport { context } from \"./scene\";\nimport useAttributes from \"./useAttributes\";\nimport { Props, Attribute, Event } from \"./types\";\ninterface ImageProps extends Props {\n  src: string;\n  style?: Attribute;\n  event?: Event;\n}\n\nfunction Image(props: ImageProps) {\n  const { state } = useContext(context);\n  const attributes = useAttributes(props);\n  useEffect(() => {\n    let image: HTMLImageElement = document.createElement(\"img\");\n    // image.setAttribute(\"crossOrigin\", \"anonymous\");\n    image.addEventListener(\"load\", () => {\n      renderImage(state.context, attributes, image);\n    });\n    image.onerror = (err) => {\n      console.log(err);\n    };\n    image.src = `${props.src}?${+new Date()}`;\n    return () => {\n      image.onerror = null;\n      image.removeEventListener(\"load\", () => {});\n    };\n    // renderImage(state.context, attributes, props.src);\n  }, [props.src]);\n\n  return null;\n}\n\nfunction renderImage(\n  ctx: CanvasRenderingContext2D,\n  attributes: Attribute,\n  image: HTMLImageElement\n): void {\n  const { left, top, width, height, border } = attributes;\n  if (left && top && width && height) {\n    if (!!border) {\n      ctx.rect(left, top, width, height);\n      ctx.stroke();\n    }\n    ctx.drawImage(image, left, top, width, height);\n  } else {\n    console.log(`renderImage<drawImage> arguments lost`);\n  }\n}\n\nexport { Image, renderImage };\n"],"names":["initialState","devicePixelRatio","canvas","context","events","shapes","Set","reducer","state","action","type","Object","assign","body","add","createContext","Scene","props","useReducer","dispatch","React","Provider","value","Stage","children","useContext","stageRef","useRef","attributes","attribute","useEffect","current","window","width","clientWidth","height","clientHeight","getContext","forEach","addEventListener","stageHandle","removeEventListener","e","node","target","getBoundingClientRect","left","top","originalX","originalY","evtArgs","originalEvent","event","isTouch","changedTouches","clientX","clientY","Math","round","x","y","shape","isInside","rect","handle","preventDefault","TouchEvent","pos","ref","style","onContextMenu","onMouseOver","cursor","onMouseOut","defaultAttributes","right","bottom","border","attritube","Text","textAlign","textBaseline","font","fillStyle","useAttributes","text","content","renderText","ctx","measureText","stroke","fillText","Image","image","document","createElement","renderImage","onerror","err","console","log","src","Date","drawImage"],"mappings":"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"}